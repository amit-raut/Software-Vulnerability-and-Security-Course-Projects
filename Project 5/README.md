#######   Browser Security   #######

Vulnerability:

	The web page includes an iframe which is linked to the advertisement network. 
The communication between the webpage [amplifier.ccs.neu.edu] and advertisement 
network [modulator.ccs.neu.edu] uses postMessage. The webpage does not provide any 
preference for the destination URL. It simply uses src.postMessage(data, “*”).


Exploiting vulnerability: 

	To perform the exploit I created a  exploit webpage which contains and iframe 
loading the content from http://amplifier.ccs.neu.edu. Now when we send message 
to amplifier.ccs.neu.edu it send us back with the postMessage which it sends to 
the advertisement network. In this way attacker can leak the content from the 
amplifier.ccs.neu.edu site.   Finally once I get the content from the amplifier.ccs.neu.edu 
I redirected the received message as a parameter to the google search. On successful 
exploit the webpage is redirected to the URL: https://www.google.com/?q=lorem,ipsum,dolore&gws_rd=ssl 


Patch to mitigate the vulnerability: 

	In the patch which I applied I changed the postMessage parameter which directs
	the postMessage to only target and not to all [like that using *]. 
On the receiving side when a message is received from advertisement network I 
checked the origin of the message sender. If the origin of the message is trustworthy 
then only application will eval the message else application simply writes the violation 
message to the browser console without evaluating the received message.

Application hardening using Content Security Policy (CSP) rules:

	I implemented the CSP which only only loads the fonts from fonts.googleapis.com
and fonts.gstatic.com. Also the CSP rule allows the content to be loaded from any 
subdomain of ccs.neu.edu. In case the script is getting executed from other subdomains 
than ccs.neu.edu then the error is logged in the browser console. Sometimes the CSP rules 
does not allow the webpages to be loaded in the browser. When I performed the testing with 
the rules I sometimes got Internal server error HTTP 500 error code.