# Browser Security Problem Set

## Description
The goal of this problem set is to perform a client-side code injection against a vulnerable web application, and modify the application to defend against the class of vulnerabilities.

To complete the problem set, you will need to ssh to your container at $user[@]amplifier.ccs.neu.edu:$port , where $user is your
gitlab username and $port is your assigned ssh port (hxxps://seclab-devel.ccs.neu.edu/snippets/6). Authentication is performed using any of your uploaded ssh public keys in gitlab.

You will also need to clone the problem set repository located at git[@]seclab-devel.ccs.neu.edu:softvulnsec/prset05.git .

## Vulnerability Identification
The web application you have cloned makes use of a third-party advertisement network to monetize the site’s content.
Examine the source code to the web application to identify a client-side injection vulnerability

## Exploit the Vulnerability
Assume that you are a malicious ad network, or have compromised the ad network. Develop an exploit for the vulnerability that you’ve
identified. As a proof-of-concept, you should leak the value document.secret to a server that you control.

## Patch the Vulnerability
Using the knowledge of how you exploited the vulnerability, develop a patch. In particular, your patch should consider both the issue of avoiding untrusted code execution and origin endpoint restrictions.

##Harden the Application
In addition to patching the specific vulnerability you’ve found, you can also harden the application against other possible vulnerabilities. Do
this by developing a CSP ruleset that is as tight as possible. Points will be deducted for overly-permissive rulesets. In particular, you should not use unsafe-inline or unsafe-eval .

Modify the application to indicate that the browser should enforce your ruleset.

## Answer Submission
Fork the repository for this problem set in gitlab. On the master branch, commit both your patch for the vulnerability as well as your
modifications to enforce a strong CSP ruleset.
In addition, commit your proof-of-concept exploit to exploit/ . Finally, commit a README.md that describes your solution as precisely as possible.


---

# Answer/ Solution

## Vulnerability:

The web page includes an iframe which is linked to the advertisement network. The communication between the webpage [amplifier.ccs.neu.edu] and advertisement network [modulator.ccs.neu.edu] uses postMessage. The webpage does not provide any 
preference for the destination URL. It simply uses src.postMessage(data, “*”).

## Exploiting vulnerability: 

To perform the exploit I created a  exploit webpage which contains and iframe loading the content from hxxp://amplifier.ccs.neu.edu. Now when we send message to amplifier.ccs.neu.edu it send us back with the postMessage which it sends to 
the advertisement network. In this way attacker can leak the content from the amplifier.ccs.neu.edu site. 

Finally once I get the content from the amplifier.ccs.neu.edu I redirected the received message as a parameter to the google search. On successful exploit the webpage is redirected to the URL: hxxps://google.com/?q=lorem,ipsum,dolore&gws_rd=ssl 


## Patch to mitigate the vulnerability: 

In the patch which I applied I changed the postMessage parameter which directs the postMessage to only target and not to all [like that using *]. On the receiving side when a message is received from advertisement network I checked the origin of the message sender. If the origin of the message is trustworthy then only application will eval the message else application simply writes the violation 
message to the browser console without evaluating the received message.

## Application hardening using Content Security Policy (CSP) rules:

I implemented the CSP which only only loads the fonts from fonts.googleapis.com and fonts.gstatic.com. Also the CSP rule allows the content to be loaded from any subdomain of ccs.neu.edu. In case the script is getting executed from other subdomains 
than ccs.neu.edu then the error is logged in the browser console. Sometimes the CSP rules does not allow the webpages to be loaded in the browser. When I performed the testing with the rules I sometimes got Internal server error HTTP 500 error code.


**Please find the files/ programs saved in specified directories. Thank you! :-)**
